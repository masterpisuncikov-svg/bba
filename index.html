<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Roblox Admin Panel</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #00adb5;
        }
        h1 { color: #00adb5; font-size: 2.5em; margin-bottom: 10px; }
        .subtitle { color: #a0a0a0; font-size: 1.1em; }

        .panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .player-section, .commands-section, .status-section {
            background: rgba(30, 30, 46, 0.7);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        h2 {
            color: #00adb5;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .player-list {
            max-height: 340px;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 10px;
            background: rgba(20,20,35,0.4);
            padding: 8px;
        }

        .player-card {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            margin: 6px 0;
            border-radius: 8px;
            background: rgba(255,255,255,0.06);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .player-card:hover {
            background: rgba(255,255,255,0.12);
            transform: translateX(4px);
        }

        .player-card.selected {
            background: rgba(0,173,181,0.25);
            border-left: 4px solid #00adb5;
        }

        .player-card img {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            margin-right: 14px;
            object-fit: cover;
            border: 2px solid rgba(0,173,181,0.4);
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: 600;
            color: #e0f7fa;
            display: block;
            font-size: 1.05em;
        }

        .player-id {
            font-size: 0.85em;
            color: #a0a0c0;
        }

        .no-players {
            text-align: center;
            padding: 60px 20px;
            color: #777;
            font-style: italic;
        }

        .selected-info {
            margin-top: 16px;
            padding: 10px;
            background: rgba(0,173,181,0.1);
            border-radius: 8px;
            text-align: center;
        }

        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .btn {
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s;
        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .btn-kill    { background: linear-gradient(135deg, #f44336, #d32f2f); color: white; }
        .btn-speedup { background: linear-gradient(135deg, #ff9800, #f57c00); color: white; }
        .btn-reset   { background: linear-gradient(135deg, #4caf50, #2e7d32); color: white; }
        .btn-custom  { background: linear-gradient(135deg, #2196f3, #1976d2); color: white; width: 100%; margin-top: 16px; }

        .input-group { margin: 15px 0; }
        input, textarea {
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
        }

        .status-box {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            min-height: 120px;
        }

        .success { color: #4caf50; }
        .error   { color: #f44336; }
        .loading { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%,100% {opacity:1;} 50% {opacity:0.6;} }

        footer {
            text-align: center;
            margin-top: 40px;
            color: #888;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Roblox Admin Panel</h1>
        <div class="subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</div>
    </header>

    <div class="panel">
        <!-- –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ -->
        <div class="player-section">
            <h2>üéÆ –ò–≥—Ä–æ–∫–∏ –æ–Ω–ª–∞–π–Ω</h2>
            
            <div id="playerList" class="player-list">
                <div class="no-players">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>

            <div class="selected-info">
                <strong>–í—ã–±—Ä–∞–Ω: </strong>
                <span id="selectedPlayerName">–Ω–∏–∫—Ç–æ</span>
                <input type="hidden" id="playerId" value="">
            </div>
        </div>

        <!-- –ö–æ–º–∞–Ω–¥—ã -->
        <div class="commands-section">
            <h2>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã</h2>
            <div class="buttons-grid">
                <button class="btn btn-kill"    onclick="sendPreset('kill', null)">üíÄ Kill</button>
                <button class="btn btn-speedup" onclick="sendPreset('speed', 1000)">üöÄ Speed √ó1000</button>
                <button class="btn btn-reset"   onclick="sendPreset('speed', 1)">üîÑ Speed √ó1</button>
            </div>

            <div class="custom-command" style="margin-top:24px;">
                <h3>–ö–∞—Å—Ç–æ–º–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞</h3>
                <div class="input-group">
                    <input type="text" id="customAction" placeholder="action (–Ω–∞–ø—Ä–∏–º–µ—Ä: give_coins)" />
                </div>
                <div class="input-group">
                    <input type="text" id="customValue" placeholder="value (—á–∏—Å–ª–æ, —Å—Ç—Ä–æ–∫–∞, JSON...)" />
                </div>
                <button class="btn btn-custom" onclick="sendCustomCommand()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å -->
        <div class="status-section">
            <h2>üì° –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞</h2>
            <div class="status-box" id="status">
                <p>–û–∂–∏–¥–∞–Ω–∏–µ...</p>
            </div>
            <button class="btn" style="margin-top:16px; background:#2196f3; color:white; width:100%;" onclick="checkServerStatus()">
                –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
            </button>
        </div>
    </div>

    <footer>
        –°–µ—Ä–≤–µ—Ä: <span id="serverUrl">–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</span><br>
        <small>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–∂–¥—ã–µ 12 —Å–µ–∫</small>
    </footer>
</div>

<script>
const SERVER_URL = "https://early-hopeful-characters--masterpisunciko.replit.app";

const statusEl     = document.getElementById('status');
const serverUrlEl  = document.getElementById('serverUrl');
const playerList   = document.getElementById('playerList');
const selectedName = document.getElementById('selectedPlayerName');
const playerIdInput = document.getElementById('playerId');

let isSending = false;

document.addEventListener('DOMContentLoaded', () => {
    serverUrlEl.textContent = SERVER_URL;
    loadPlayersList();
    checkServerStatus();
    setInterval(loadPlayersList, 12000);
    setInterval(checkServerStatusIfNeeded, 30000);
});

async function loadPlayersList() {
    try {
        playerList.innerHTML = '<div class="no-players">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–æ–≤...</div>';

        const res = await fetch(`${SERVER_URL}/players`);
        if (!res.ok) throw new Error(`–°–µ—Ä–≤–µ—Ä –∏–≥—Ä–æ–∫–æ–≤: HTTP ${res.status}`);

        const data = await res.json();
        if (!data.success) throw new Error(data.error || '–æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');

        playerList.innerHTML = '';

        if (data.players.length === 0) {
            playerList.innerHTML = '<div class="no-players">–ù–∏–∫—Ç–æ –Ω–µ –≤ –∏–≥—Ä–µ...</div>';
            selectedName.textContent = '–Ω–∏–∫—Ç–æ';
            playerIdInput.value = '';
            return;
        }

        for (const p of data.players) {
            const card = document.createElement('div');
            card.className = 'player-card';
            card.dataset.userid = p.id;

            // ‚îÄ‚îÄ‚îÄ –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—É—é –∞–≤–∞—Ç–∞—Ä–∫—É ‚îÄ‚îÄ‚îÄ
            let avatarUrl = 'https://www.roblox.com/headshot-thumbnail/image?userId=1&width=48&height=48&format=png'; // fallback

            try {
                const thumbRes = await fetch(
                    `https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=${p.id}&size=48x48&format=Png&isCircular=true`
                );
                if (thumbRes.ok) {
                    const thumbData = await thumbRes.json();
                    if (thumbData.data?.[0]?.state === 'Completed' && thumbData.data[0].imageUrl) {
                        avatarUrl = thumbData.data[0].imageUrl;
                    } else if (thumbData.data?.[0]?.state === 'Pending') {
                        // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å "–∑–∞–≥—Ä—É–∑–∫–∞" –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å fallback
                    }
                }
            } catch (thumbErr) {
                console.warn(`–ê–≤–∞—Ç–∞—Ä–∫–∞ ${p.id} –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å:`, thumbErr);
            }

            card.innerHTML = `
                <img src="${avatarUrl}" alt="${p.name}"
                     onerror="this.src='https://www.roblox.com/headshot-thumbnail/image?userId=1&width=48&height=48&format=png'">
                <div class="player-info">
                    <span class="player-name">${p.name}</span>
                    <span class="player-id">ID: ${p.id}</span>
                </div>
            `;

            card.onclick = () => {
                document.querySelectorAll('.player-card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                playerIdInput.value = p.id;
                selectedName.textContent = p.name;
            };

            playerList.appendChild(card);
        }

    } catch (err) {
        playerList.innerHTML = `<div class="no-players">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${err.message}</div>`;
        console.error(err);
    }
}
async function checkServerStatus() {
    try {
        const res = await fetch(`${SERVER_URL}/status`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        statusEl.innerHTML = `
            <p class="success">‚úÖ –û–Ω–ª–∞–π–Ω<br>
            –ò–≥—Ä–æ–∫–æ–≤: ${data.playersOnline || 0}<br>
            –ö–æ–º–∞–Ω–¥ –≤ –æ—á–µ—Ä–µ–¥–∏: ${data.pendingCommands || 0}</p>
        `;
    } catch (err) {
        statusEl.innerHTML = `<p class="error">‚ùå –ù–µ—Ç —Å–≤—è–∑–∏: ${err.message}</p>`;
    }
}

function checkServerStatusIfNeeded() {
    // –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É, –µ—Å–ª–∏ –¥–∞–≤–Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏
    checkServerStatus();
}

async function sendCommand(action, value = null) {
    if (isSending) return;
    isSending = true;

    const playerId = playerIdInput.value.trim();
    if (!playerId) {
        statusEl.innerHTML = '<p class="error">‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä–æ–∫–∞!</p>';
        isSending = false;
        return;
    }

    try {
        const res = await fetch(`${SERVER_URL}/command`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ playerId, action, value })
        });

        const data = await res.json();
        if (data.success) {
            statusEl.innerHTML = `<p class="success">‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: ${action} (ID: ${data.commandId})</p>`;
        } else {
            statusEl.innerHTML = `<p class="error">‚ùå ${data.error || '–æ—à–∏–±–∫–∞'}</p>`;
        }
    } catch (err) {
        statusEl.innerHTML = `<p class="error">‚ùå –°–µ—Ç—å: ${err.message}</p>`;
    } finally {
        isSending = false;
    }
}

function sendPreset(action, value) {
    sendCommand(action, value);
}

function sendCustomCommand() {
    const action = document.getElementById('customAction').value.trim();
    let value = document.getElementById('customValue').value.trim();

    if (!action) {
        statusEl.innerHTML = '<p class="error">–í–≤–µ–¥–∏—Ç–µ action</p>';
        return;
    }

    try {
        if (value && (value.startsWith('{') || value.startsWith('['))) {
            value = JSON.parse(value);
        }
    } catch (e) {}

    sendCommand(action, value || null);
}
</script>
</body>
</html>
